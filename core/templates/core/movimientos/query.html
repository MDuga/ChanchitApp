{% extends "core/base.html" %}
{% load widget_tweaks %}

{% block title %} Consultar Movimientos {% endblock %}

{% block content %}
<div class="container mt-5">

  <!-- Filtros -->
  <div class="row">
    <!-- Card Mes -->
    <div class="col-md-6 mb-4">
      <div class="card shadow h-100">
        <div class="card-body">
          <h5 class="card-title text-center mb-4">üìÖ Consulta por mes</h5>
          <form method="get" class="row g-3">  
            <div class="col-6 mb-3">
              <label for="id_month" class="form-label fw-bold">Mes</label>
              <div>
                {{ form_mes.month|add_class:"form-control" }}
              </div>
            </div>
            <div class="col-6 mb-3">
              <label for="id_year" class="form-label fw-bold">A√±o</label>
              <div>
                {{ form_mes.year|add_class:"form-control" }}
              </div>
            </div>

        </div>
        <div class="card-footer">
          <button type="submit" class="btn btn-primary w-100">Consultar</button>
        </div>
          </form>
      </div>
    </div>

    <!-- Card Rango Fechas -->
    <div class="col-md-6 mb-4">
      <div class="card shadow h-100">
        <div class="card-body">
          <h5 class="card-title text-center mb-4">üìÜ Consulta por fecha</h5>
          <form method="get" class="row g-3">
            <div class="col-6">
              <label for="id_inicio" class="form-label fw-bold">Inicio</label>
              {{ form_fechas.inicio }}
            </div>
            <div class="col-6">
              <label for="id_fin" class="form-label fw-bold">Fin</label>
              {{ form_fechas.fin }}
            </div>
        </div>
        <div class="card-footer">
          <button type="submit" class="btn btn-primary w-100">Consultar</button>
        </div>
          </form>
      </div>
    </div>
  </div>

  <!-- Resultados -->
  {% if saldo_inicial is not None %}
    <div class="card shadow mt-4">
      <div class="card-body">
        <!-- Saldo inicial -->
        <h5>üíº Saldo al inicio:</h5>
        <p><strong>{{ saldo_inicial }} UYU</strong></p>

        <!-- Movimientos -->
        <h5>üìë Movimientos:</h5>
        {% if movimientos %}
          <table class="table table-striped table-bordered text-center align-middle">
            <thead class="table-dark">
              <tr>
                <th>Tipo</th>
                <th>Fecha</th>
                <th>Descripci√≥n</th>
                <th>Categor√≠a</th>
                <th>Monto</th>
                <th>Moneda</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for mov in movimientos %}
                <tr>
                  <td>{{ mov.tipo_modelo }}</td>
                  <td>{{ mov.date_movimiento|date:"d/m/Y" }}</td>
                  <td>{{ mov.descripcion }}</td>
                  <td>{{ mov.get_categoria_display }}</td>
                  <td class="{% if mov.monto >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {{ mov.monto }}
                  </td>
                  <td>{{ mov.moneda }}</td>
                    <td>
                    {% if mov.tipo_modelo == "Ingresos" %}
                      <a href="{% url 'update_ingreso' mov.uuid %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è Editar</a> /
                      <a href="{% url 'delete_ingreso' mov.uuid %}" class="btn btn-sm btn-outline-danger">üóëÔ∏è Eliminar</a>
                    {% else %}
                      <a href="{% url 'update_egreso' mov.uuid %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è Editar</a> /
                      <a href="{% url 'delete_egreso' mov.uuid %}" class="btn btn-sm btn-outline-danger">üóëÔ∏è Eliminar</a>
                    {% endif %}
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="6" class="text-muted">No se encontraron movimientos.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div class="alert alert-info">
            No hay movimientos para este per√≠odo.
          </div>
        {% endif %}

        <!-- Saldo final -->
        <h5>üìä Saldo final:</h5>
        <h3 class="text-center {% if saldo_final >= 0 %}text-success{% else %}text-danger{% endif %}">
          {{ saldo_final }} UYU
        </h3>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
