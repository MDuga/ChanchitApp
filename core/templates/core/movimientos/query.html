{% extends "core/base.html" %}
{% load widget_tweaks %}

{% block title %} Consultar Movimientos {% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- Filtros -->
  <div class="row">
    <!-- Card Mes -->
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body py-3 px-3">
          <h6 class="card-title text-center mb-3 fw-bold text-primary">üìÖ Consulta por mes</h6>
          <form method="get" class="row g-2">  
            <div class="col-6">
              <label for="id_month" class="form-label small fw-semibold">Mes</label>
              {{ form_mes.month|add_class:"form-control form-control-sm" }}
            </div>
            <div class="col-6">
              <label for="id_year" class="form-label small fw-semibold">A√±o</label>
              {{ form_mes.year|add_class:"form-control form-control-sm" }}
            </div>
            <div class="col-12 mt-2">
              <button type="submit" class="btn btn-primary btn-sm w-100">Consultar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Card Rango Fechas -->
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body py-3 px-3">
          <h6 class="card-title text-center mb-3 fw-bold text-primary">üìÜ Consulta por fecha</h6>
          <form method="get" class="row g-2">
            <div class="col-6">
              <label for="id_inicio" class="form-label small fw-semibold">Inicio</label>
              {{ form_fechas.inicio|add_class:"form-control form-control-sm" }}
            </div>
            <div class="col-6">
              <label for="id_fin" class="form-label small fw-semibold">Fin</label>
              {{ form_fechas.fin|add_class:"form-control form-control-sm" }}
            </div>
            <div class="col-12 mt-2">
              <button type="submit" class="btn btn-primary btn-sm w-100">Consultar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Resultados -->
  {% if saldo_inicial is not None %}
    <div class="card shadow-sm border-0 mt-3">
      <div class="card-body p-3">
        <h6 class="fw-bold mb-1 text-primary">üíº Saldo al inicio:</h6>
        <p class="mb-3"><strong>{{ saldo_inicial }} UYU</strong></p>

        <h6 class="fw-bold mb-2 text-primary">üìë Movimientos:</h6>
        {% if movimientos %}
          <table class="table table-sm table-striped table-bordered align-middle text-center mb-3">
            <thead class="table-dark small">
              <tr>
                <th>Tipo</th>
                <th>Fecha</th>
                <th>Descripci√≥n</th>
                <th>Categor√≠a</th>
                <th>Monto</th>
                <th>Moneda</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody class="small">
              {% for mov in movimientos %}
                <tr>
                  <td>{{ mov.tipo_modelo }}</td>
                  <td>{{ mov.date_movimiento|date:"d/m/Y" }}</td>
                  <td>{{ mov.descripcion }}</td>
                  <td>{{ mov.get_categoria_display }}</td>
                  <td class="{% if mov.monto >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {{ mov.monto }}
                  </td>
                  <td>{{ mov.moneda }}</td>
                  <td>
                    {% if mov.tipo_modelo == "Ingresos" %}
                      <a href="{% url 'update_ingreso' mov.uuid %}" class="btn btn-sm btn-outline-primary py-0 px-2">‚úèÔ∏è</a>
                      <a href="{% url 'delete_ingreso' mov.uuid %}" class="btn btn-sm btn-outline-danger py-0 px-2">üóëÔ∏è</a>
                    {% else %}
                      <a href="{% url 'update_egreso' mov.uuid %}" class="btn btn-sm btn-outline-primary py-0 px-2">‚úèÔ∏è</a>
                      <a href="{% url 'delete_egreso' mov.uuid %}" class="btn btn-sm btn-outline-danger py-0 px-2">üóëÔ∏è</a>
                    {% endif %}
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="7" class="text-muted small">No se encontraron movimientos.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div class="alert alert-info py-2 mb-2 small text-center">
            No hay movimientos para este per√≠odo.
          </div>
        {% endif %}

        <h6 class="fw-bold mb-1 text-primary">üìä Saldo final:</h6>
        <h4 class="text-center {% if saldo_final >= 0 %}text-success{% else %}text-danger{% endif %} mb-0">
          {{ saldo_final }} UYU
        </h4>
      </div>
    </div>
  {% endif %}
</div>

<style>
  body { font-size: 0.9rem; }
  .card { border-radius: 10px; }
  .table th, .table td { padding: 4px 6px !important; }
  .btn-sm { font-size: 0.8rem; border-radius: 6px; }
  h5, h6 { margin-bottom: 0.3rem !important; }
</style>
{% endblock %}
